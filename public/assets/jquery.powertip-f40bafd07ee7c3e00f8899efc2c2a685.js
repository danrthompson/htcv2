/**
 * PowerTip
 *
 * @fileoverview  jQuery plugin that creates hover tooltips.
 * @link          http://stevenbenner.github.com/jquery-powertip/
 * @author        Steven Benner (http://stevenbenner.com/)
 * @version       1.1.0
 * @requires      jQuery 1.7+
 *
 * @license jQuery PowerTip Plugin v1.1.0
 * http://stevenbenner.github.com/jquery-powertip/
 * Copyright 2012 Steven Benner (http://stevenbenner.com/)
 * Released under the MIT license.
 * <https://raw.github.com/stevenbenner/jquery-powertip/master/LICENSE.txt>
 */
!function(e){"use strict";function t(e,t,i){function n(n,s){r(),e.data("hasActiveHover")||(n?(s&&e.data("forcedOpen",!0),i.showTip(e)):(h.popOpenImminent=!0,o=setTimeout(function(){o=null,a(e)},t.intentPollInterval)))}function s(n){r(),e.data("hasActiveHover")&&(h.popOpenImminent=!1,e.data("forcedOpen",!1),n?i.hideTip(e):o=setTimeout(function(){o=null,i.hideTip(e)},t.closeDelay))}function a(){var s=Math.abs(h.previousX-h.currentX),a=Math.abs(h.previousY-h.currentY),r=s+a;r<t.intentSensitivity?i.showTip(e):(h.previousX=h.currentX,h.previousY=h.currentY,n())}function r(){o=clearTimeout(o)}var o=null;return{show:n,hide:s,cancel:r}}function i(t){function i(e){e.data("hasActiveHover",!0),m.queue(function(t){n(e),t()})}function n(i){if(i.data("hasActiveHover")){if(h.isPopOpen)return h.isClosing||s(h.activeHover),m.delay(100).queue(function(e){n(i),e()}),void 0;i.trigger("powerTipPreRender");var a=i.data("powertip"),r=i.data("powertiptarget"),l=i.data("powertipjq"),c=r?e("#"+r):[];if(a)m.html(a);else if(l&&l.length>0)m.empty(),l.clone(!0,!0).appendTo(m);else{if(!(c&&c.length>0))return;m.html(e("#"+r).html())}i.trigger("powerTipRender"),o.on("closePowerTip",function(){i.data("displayController").hide(!0)}),h.activeHover=i,h.isPopOpen=!0,m.data("followMouse",t.followMouse),m.data("mouseOnToPopup",t.mouseOnToPopup),t.followMouse?d():(p(i),h.isFixedPopOpen=!0),m.fadeIn(t.fadeInTime,function(){h.desyncTimeout||(h.desyncTimeout=setInterval(u,500)),i.trigger("powerTipOpen")})}}function s(e){h.isClosing=!0,e.data("hasActiveHover",!1),e.data("forcedOpen",!1),h.activeHover=null,h.isPopOpen=!1,h.desyncTimeout=clearInterval(h.desyncTimeout),o.off("closePowerTip"),m.fadeOut(t.fadeOutTime,function(){h.isClosing=!1,h.isFixedPopOpen=!1,m.removeClass(),g(h.currentX+t.offset,h.currentY+t.offset),e.trigger("powerTipClose")})}function u(){if(h.isPopOpen&&!h.isClosing){var e=!1;h.activeHover.data("hasActiveHover")===!1?e=!0:a(h.activeHover)||h.activeHover.is(":focus")||h.activeHover.data("forcedOpen")||(m.data("mouseOnToPopup")?a(m)||(e=!0):e=!0),e&&s(h.activeHover)}}function d(){if(h.isPopOpen&&!h.isFixedPopOpen||h.popOpenImminent&&!h.isFixedPopOpen&&m.data("hasMouseMove")){var e=l.scrollTop(),i=l.width(),n=l.height(),s=m.outerWidth(),a=m.outerHeight(),r=0,o=0;r=s+h.currentX+t.offset<i?h.currentX+t.offset:i-s,o=a+h.currentY+t.offset<e+n?h.currentY+t.offset:e+n-a,g(r,o)}}function p(i){var n,s,a,o,l=m.outerWidth(),c=m.outerHeight();t.smartPlacement?(n=e.fn.powerTip.smartPlacementLists[t.placement],e.each(n,function(e,t){return s=f(i,t,l,c),a=t,o=r(s,l,c),0===o.length?!1:void 0})):(s=f(i,t.placement,l,c),a=t.placement),m.addClass(a),g(s.x,s.y)}function f(e,i,n,s){var a=e.offset(),r=e.outerWidth(),o=e.outerHeight(),l=0,c=0;switch(i){case"n":l=a.left+r/2-n/2,c=a.top-s-t.offset;break;case"e":l=a.left+r+t.offset,c=a.top+o/2-s/2;break;case"s":l=a.left+r/2-n/2,c=a.top+o+t.offset;break;case"w":l=a.left-n-t.offset,c=a.top+o/2-s/2;break;case"nw":l=a.left-n+20,c=a.top-s-t.offset;break;case"ne":l=a.left+r-20,c=a.top-s-t.offset;break;case"sw":l=a.left-n+20,c=a.top+o+t.offset;break;case"se":l=a.left+r-20,c=a.top+o+t.offset}return{x:Math.round(l),y:Math.round(c)}}function g(e,t){m.css("left",e+"px"),m.css("top",t+"px")}var m=e("#"+t.popupId);return 0===m.length&&(m=e("<div></div>",{id:t.popupId}),0===c.length&&(c=e("body")),c.append(m)),t.followMouse&&(m.data("hasMouseMove")||o.on({mousemove:d,scroll:d}),m.data("hasMouseMove",!0)),(t.followMouse||t.mouseOnToPopup)&&m.on({mouseenter:function(){(m.data("followMouse")||m.data("mouseOnToPopup"))&&h.activeHover&&h.activeHover.data("displayController").cancel()},mouseleave:function(){m.data("mouseOnToPopup")&&h.activeHover&&h.activeHover.data("displayController").hide()}}),{showTip:i,hideTip:s}}function n(){var t=0,i=0;h.mouseTrackingActive||(h.mouseTrackingActive=!0,e(function(){t=o.scrollLeft(),i=o.scrollTop()}),o.on({mousemove:s,scroll:function(){var e=o.scrollLeft(),n=o.scrollTop();e!==t&&(h.currentX+=e-t,t=e),n!==i&&(h.currentY+=n-i,i=n)}}))}function s(e){h.currentX=e.pageX,h.currentY=e.pageY}function a(e){var t=e.offset();return h.currentX>=t.left&&h.currentX<=t.left+e.outerWidth()&&h.currentY>=t.top&&h.currentY<=t.top+e.outerHeight()}function r(e,t,i){var n=l.scrollLeft(),s=l.scrollTop(),a=l.width(),r=l.height(),o=[];return e.y<s&&o.push("top"),e.y+i>s+r&&o.push("bottom"),e.x<n&&o.push("left"),e.x+t>n+a&&o.push("right"),o}var o=e(document),l=e(window),c=e("body"),h={isPopOpen:!1,isFixedPopOpen:!1,isClosing:!1,popOpenImminent:!1,activeHover:null,currentX:0,currentY:0,previousX:0,previousY:0,desyncTimeout:null,mouseTrackingActive:!1};e.fn.powerTip=function(r){if(!this.length)return this;var o=e.extend({},e.fn.powerTip.defaults,r),l=new i(o);return n(),this.each(function(){var i=e(this),n=i.data("powertip"),s=i.data("powertipjq"),a=i.data("powertiptarget"),r=i.attr("title");n||a||s||!r||(i.data("powertip",r),i.removeAttr("title")),i.data("displayController",new t(i,o,l))}),this.on({mouseenter:function(t){s(t),h.previousX=t.pageX,h.previousY=t.pageY,e(this).data("displayController").show()},mouseleave:function(){e(this).data("displayController").hide()},focus:function(){var t=e(this);a(t)||t.data("displayController").show(!0)},blur:function(){e(this).data("displayController").hide(!0)}})},e.fn.powerTip.defaults={fadeInTime:200,fadeOutTime:100,followMouse:!1,popupId:"powerTip",intentSensitivity:7,intentPollInterval:100,closeDelay:100,placement:"n",smartPlacement:!1,offset:10,mouseOnToPopup:!1},e.fn.powerTip.smartPlacementLists={n:["n","ne","nw","s"],e:["e","ne","se","w","nw","sw","n","s","e"],s:["s","se","sw","n"],w:["w","nw","sw","e","ne","se","n","s","w"],nw:["nw","w","sw","n","s","se","nw"],ne:["ne","e","se","n","s","sw","ne"],sw:["sw","w","nw","s","n","ne","sw"],se:["se","e","ne","s","n","nw","se"]},e.powerTip={showTip:function(t){e.powerTip.closeTip(),t=t.first(),a(t)||t.data("displayController").show(!0,!0)},closeTip:function(){o.triggerHandler("closePowerTip")}}}(jQuery);