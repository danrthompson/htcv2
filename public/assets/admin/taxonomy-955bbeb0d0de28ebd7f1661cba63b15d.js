!function(){var e,t,i,n,s,a;e=function(){return $.jstree.rollback(last_rollback),$("#ajax_error").show().html("<strong>"+server_error+"</strong><br />"+taxonomy_tree_error)},n=function(t,i){var n,s,a,r,o;return n=i.rlbk,r=i.rslt.cp,a=i.rslt.o,s=i.rslt.np,o=Spree.url(base_url).clone(),o.setPath(o.path()+"/"+a.attr("id")),$.ajax({type:"POST",dataType:"json",url:o.toString(),data:{_method:"put","taxon[parent_id]":s.attr("id"),"taxon[position]":r},error:e}),!0},t=function(t,i){var n,s,a,r,o;return n=i.rlbk,r=i.rslt.obj,s=i.rslt.name,o=i.rslt.position,a=i.rslt.parent,$.ajax({type:"POST",dataType:"json",url:base_url.toString(),data:{"taxon[name]":s,"taxon[parent_id]":a.attr("id"),"taxon[position]":o},error:e,success:function(e){return r.attr("id",e.id)}})},s=function(t,i){var n,s,a,r;return n=i.rlbk,a=i.rslt.obj,s=i.rslt.new_name,r=Spree.url(base_url).clone(),r.setPath(r.path()+"/"+a.attr("id")),$.ajax({type:"POST",dataType:"json",url:r.toString(),data:{_method:"put","taxon[name]":s},error:e})},i=function(t,i){var n,s,a;return s=i.rlbk,a=i.rslt.obj,n=base_url.clone(),n.setPath(n.path()+"/"+a.attr("id")),jConfirm(Spree.translations.are_you_sure_delete,Spree.translations.confirm_delete,function(t){return t?$.ajax({type:"POST",dataType:"json",url:n.toString(),data:{_method:"delete"},error:e}):($.jstree.rollback(s),s=null)})},a="undefined"!=typeof exports&&null!==exports?exports:this,a.setup_taxonomy_tree=function(e){return void 0!==e?(a.base_url=Spree.url(Spree.routes.taxonomy_taxons_path),$.ajax({url:base_url.path().replace("/taxons","/jstree"),success:function(e){var a,r;return r=null,a={json_data:{data:e,ajax:{url:function(e){return base_url.path()+"/"+e.attr("id")+"/jstree"}}},themes:{theme:"apple",url:"/assets/jquery.jstree/themes/apple/style.css"},strings:{new_node:new_taxon,loading:Spree.translations.loading+"..."},crrm:{move:{check_move:function(e){var t,i,n;return n=e.cp,i=e.o,t=e.np,t&&"root"!==i.attr("rel")?"taxonomy_tree"===t.attr("id")&&0===n?!1:!0:!1}}},contextmenu:{items:function(e){return taxon_tree_menu(e,this)}},plugins:["themes","json_data","dnd","crrm","contextmenu"]},$("#taxonomy_tree").jstree(a).bind("move_node.jstree",n).bind("remove.jstree",i).bind("create.jstree",t).bind("rename.jstree",s).bind("loaded.jstree",function(){return $(this).jstree("core").toggle_node($(".jstree-icon").first())})}}),$("#taxonomy_tree a").on("dblclick",function(){return $("#taxonomy_tree").jstree("rename",this)}),$(document).keypress(function(e){return 13===e.keyCode?e.preventDefault():void 0})):void 0}}.call(this);