function restripe(){$("table tr:odd").removeClass("alt"),$("table tr:even").addClass("alt")}function asyncDeleteForm(e,t){$.ajax($.extend({type:"DELETE",url:e.attr("action"),beforeSend:function(e){e.setRequestHeader("Accept","application/json")},dataType:"json",success:function(e){display=e.undo_message,e.undo_path&&(display+='<span class="undo-link"> (<a class="undo-link" href="'+e.undo_path+'">undo</a>)</span>',undo_stack.push(e.undo_path)),humanMsg.displayMsg(display)},error:function(){humanMsg.displayMsg("Could not delete item, or maybe it has already been deleted")}},t||{}))}function processUndo(e,t){$.ajax($.extend({type:"POST",url:e,beforeSend:function(e){e.setRequestHeader("Accept","application/json")},dataType:"json",success:function(e){humanMsg.displayMsg(e.message)},error:function(){humanMsg.displayMsg("Could not undo")}},t||{})),$("a.undo-link[href="+e+"]").parent("span").hide(),undo_stack=jQuery.grep(undo_stack,function(t){return t!=e})}function asyncUndoBehaviour(e){$("#humanMsgLog").click($.delegate({"a.undo-link":function(t){return processUndo(jQuery(t.target).attr("href"),e),!1}})),jQuery.each(["Ctrl+Z","Meta+Z"],function(){shortcut.add(this,function(){item=undo_stack.pop(),item?processUndo(item,e):humanMsg.displayMsg("Nothing to undo")})})}function onDeleteFormClick(){return asyncDeleteForm($(this)),$(this).parent("td").parent("tr").remove(),restripe(),!1}function destroyAndUndoBehaviour(e){return function(){asyncUndoBehaviour({success:function(t){humanMsg.displayMsg(t.message),$.get("/admin/"+e+"/"+t.obj.id,function(e){$("table tbody").append(e),$("form.delete-item").unbind("submit",onDeleteFormClick),$("form.delete-item").submit(onDeleteFormClick),restripe()})}}),$("form.delete-item").submit(onDeleteFormClick)}}jQuery.delegate=function(e){return function(t){var i=$(t.target);for(var n in e)if(i.is(n))return e[n].apply(this,$.makeArray(arguments))}},$(document).ajaxSend(function(e,t){var i=$("meta[name='csrf-token']").attr("content");t.setRequestHeader("X-CSRF-Token",i)});var undo_stack=new Array;$(document).ready(function(){$(["posts","comments","pages"]).each(function(){$("#"+this).length>0&&destroyAndUndoBehaviour(this)()})});