!function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};$(function(){var e,i,n,s,a,r,o,l;return s=function(){function e(e){this.variant=e,this.id=this.variant.id,this.name=""+this.variant.name+" - "+this.variant.sku,this.quantity=0}return e.prototype.add=function(e){return this.quantity+=e},e}(),n=function(e){function i(e){this.stock_item=e,i.__super__.constructor.call(this,this.stock_item.variant),this.count_on_hand=this.stock_item.count_on_hand,this.name=""+this.variant.name+" - "+this.variant.sku+" ("+this.count_on_hand+")"}return t(i,e),i.prototype.add=function(e){return this.quantity+=e,this.quantity>this.count_on_hand?this.quantity=this.count_on_hand:void 0},i}(s),i=function(){function e(){var e=this;this.source=$("#transfer_source_location_id"),this.destination=$("#transfer_destination_location_id"),this.source.change(function(){return e.populate_destination()}),$("#transfer_receive_stock").change(function(t){return e.receive_stock_change(t)}),$.getJSON("/api/stock_locations",function(t){var i;return e.locations=function(){var e,n,s,a;for(s=t.stock_locations,a=[],e=0,n=s.length;n>e;e++)i=s[e],a.push(i);return a}(),e.locations.length<2&&e.force_receive_stock(),e.populate_source(),e.populate_destination()})}return e.prototype.force_receive_stock=function(){return $("#receive_stock_field").hide(),$("#transfer_receive_stock").prop("checked",!0),this.toggle_source_location(!0)},e.prototype.is_source_location_hidden=function(){return"hidden"===$("#transfer_source_location_id_field").css("visibility")},e.prototype.toggle_source_location=function(e){return null==e&&(e=!1),this.source.trigger("change"),this.is_source_location_hidden()&&!e?$("#transfer_source_location_id_field").css("visibility","visible"):$("#transfer_source_location_id_field").css("visibility","hidden")},e.prototype.receive_stock_change=function(e){return this.toggle_source_location(e.target.checked),this.populate_destination(!e.target.checked)},e.prototype.populate_source=function(){return this.populate_select(this.source),this.source.trigger("change")},e.prototype.populate_destination=function(e){return null==e&&(e=!0),this.is_source_location_hidden()?this.populate_select(this.destination):this.populate_select(this.destination,parseInt(this.source.val()))},e.prototype.populate_select=function(e,t){var i,n,s,a;for(null==t&&(t=0),e.children("option").remove(),a=this.locations,n=0,s=a.length;s>n;n++)i=a[n],i.id!==t&&e.append($("<option></option>").text(i.name).attr("value",i.id));return e.select2()},e}(),a=function(){function e(){var e=this;$("#transfer_source_location_id").change(function(){return e.refresh_variants()})}return e.prototype.receiving_stock=function(){return $("#transfer_receive_stock:checked").length>0},e.prototype.refresh_variants=function(){return this.receiving_stock()?this._refresh_transfer_variants():this._refresh_transfer_stock_items()},e.prototype._refresh_transfer_variants=function(){var e=this;return null!=this.cached_variants?this.populate_select(this.cached_variants):$.getJSON("/api/variants",function(t){return e.cached_variants=_.map(t.variants,function(e){return new s(e)}),e.populate_select(e.cached_variants)})},e.prototype._refresh_transfer_stock_items=function(){var e,t=this;return e=$("#transfer_source_location_id").val(),$.getJSON("/api/stock_locations/"+e+"/stock_items",function(e){return t.populate_select(_.map(e.stock_items,function(e){return new n(e)}))})},e.prototype.populate_select=function(e){var t,i,n;for($("#transfer_variant").children("option").remove(),i=0,n=e.length;n>i;i++)t=e[i],$("#transfer_variant").append($("<option></option>").text(t.name).attr("value",t.id).data("variant",t));return $("#transfer_variant").select2()},e}(),e=function(){function e(){var e=this;this.variants=[],this.template=Handlebars.compile($("#transfer_variant_template").html()),$("#transfer_source_location_id").change(function(){return e.clear_variants()}),$("button.transfer_add_variant").click(function(t){return t.preventDefault(),e.add_variant()}),$("#transfer-variants-table").on("click",".transfer_remove_variant",function(t){return t.preventDefault(),e.remove_variant($(t.target))}),$("button.transfer_transfer").click(function(){return e.variants.length>0?void 0:(alert("no variants to transfer"),!1)})}return e.prototype.add_variant=function(){var e,t;return t=$("#transfer_variant option:selected").data("variant"),e=parseInt($("#transfer_variant_quantity").val()),t=this.find_or_add(t),t.add(e),this.render()},e.prototype.find_or_add=function(e){var t;return(t=_.find(this.variants,function(t){return t.id===e.id}))?t:(e=$.extend({},e),this.variants.push(e),e)},e.prototype.remove_variant=function(e){var t,i;return i=parseInt(e.data("variantId")),this.variants=function(){var e,n,s,a;for(s=this.variants,a=[],e=0,n=s.length;n>e;e++)t=s[e],t.id!==i&&a.push(t);return a}.call(this),this.render()},e.prototype.clear_variants=function(){return this.variants=[],this.render()},e.prototype.contains=function(e){return _.contains(_.pluck(this.variants,"id"),e)},e.prototype.render=function(){var e;return 0===this.variants.length?($("#transfer-variants-table").hide(),$(".no-objects-found").show()):($("#transfer-variants-table").show(),$(".no-objects-found").hide(),e=this.template({variants:this.variants}),$("#transfer_variants_tbody").html(e))},e}(),$("#transfer_source_location_id").length>0?(o=new i,l=new a,r=new e):void 0})}.call(this);